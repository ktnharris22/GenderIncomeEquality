---
title: "What Riri got Right: Gender & Pay Inequity"
author: "Jaih Hunter-Hill & Katie Harris"
date: 'December 14, 2020'
output: html_document
---

#### Package loading

```{r}
library(tidyverse)
library(knitr)
library(ggplot2)
```


#### Importing the data

```{r}
# Import starting data
nlsy <- read_csv("http://www.andrew.cmu.edu/user/achoulde/94842/final_project/nlsy97/nlsy97_Nov2020.csv")

encoded.names <- names(nlsy)
```

#### Variables present in the base data set

To learn more about the data, you can have a look at the [variable codebook file](http://www.andrew.cmu.edu/user/achoulde/94842/final_project/nlsy97/nlsy97_codebook.txt).


Here's how to rename all the variables to the Question Name abbreviation.  **You will want to change the names to be even more descriptive**, but this is a start.

```{r}
# Change column names to question name abbreviations (you will want to change these further)
colnames(nlsy) <- c("PSTRAN_GPA.01_PSTR",
    "INCARC_TOTNUM_XRND",
    "INCARC_AGE_FIRST_XRND",
    "INCARC_LENGTH_LONGEST_XRND",
    "PUBID_1997",
    "YSCH-36400_1997",
    "YSCH-37000_1997",
    "YSAQ-010_1997",
    "YSAQ-369_1997",
    "YEXP-300_1997",
    "YEXP-1500_1997",
    "YEXP-1600_1997",
    "YEXP-1800_1997",
    "YEXP-2000_1997",
    "sex",
    "KEY_BDATE_M_1997",
    "KEY_BDATE_Y_1997",
    "PC8-090_1997",
    "PC8-092_1997",
    "PC9-002_1997",
    "PC12-024_1997",
    "PC12-028_1997",
    "CV_AGE_12/31/96_1997",
    "CV_BIO_MOM_AGE_CHILD1_1997",
    "CV_BIO_MOM_AGE_YOUTH_1997",
    "CV_CITIZENSHIP_1997",
    "CV_ENROLLSTAT_1997",
    "CV_HH_NET_WORTH_P_1997",
    "CV_YTH_REL_HH_CURRENT_1997",
    "CV_MSA_AGE_12_1997",
    "CV_URBAN-RURAL_AGE_12_1997",
    "CV_SAMPLE_TYPE_1997",
    "CV_HGC_BIO_DAD_1997",
    "CV_HGC_BIO_MOM_1997",
    "CV_HGC_RES_DAD_1997",
    "CV_HGC_RES_MOM_1997",
    "race",
    "YSCH-6800_1998",
    "YSCH-7300_1998",
    "YSAQ-372B_1998",
    "YSAQ-371_2000",
    "YSAQ-282J_2002",
    "YSAQ-282Q_2002",
    "CV_HH_NET_WORTH_Y_2003",
    "CV_BA_CREDITS.01_2004",
    "YSAQ-000B_2004",
    "YSAQ-373_2004",
    "YSAQ-369_2005",
    "CV_BIO_CHILD_HH_2007",
    "YTEL-52~000001_2007",
    "YTEL-52~000002_2007",
    "YTEL-52~000003_2007",
    "YTEL-52~000004_2007",
    "CV_BIO_CHILD_HH_2009",
    "CV_COLLEGE_TYPE.01_2011",
    "CV_INCOME_FAMILY_2011",
    "CV_HH_SIZE_2011",
    "CV_HH_UNDER_18_2011",
    "CV_HH_UNDER_6_2011",
    "CV_HIGHEST_DEGREE_1112_2011",
    "CV_BIO_CHILD_HH_2011",
    "YSCH-3112_2011",
    "YSAQ-000A000001_2011",
    "YSAQ-000A000002_2011",
    "YSAQ-000B_2011",
    "YSAQ-360C_2011",
    "YSAQ-364D_2011",
    "YSAQ-371_2011",
    "YSAQ-372CC_2011",
    "YSAQ-373_2011",
    "YSAQ-374_2011",
    "YEMP_INDCODE-2002.01_2011",
    "CV_BIO_CHILD_HH_2015",
    "YEMP_INDCODE-2002.01_2017",
    "YEMP_OCCODE-2002.01_2017",
    "CV_MARSTAT_COLLAPSED_2017",
    "YINC-1400_2017",
    "income",
    "YINC-1800_2017",
    "YINC-2400_2017",
    "YINC-2600_2017",
    "YINC-2700_2017",
    "CVC_YTH_REL_HH_AGE6_YCHR_XRND",
    "CVC_SAT_MATH_SCORE_2007_XRND",
    "CVC_SAT_VERBAL_SCORE_2007_XRND",
    "CVC_ACT_SCORE_2007_XRND",
    "CVC_HH_NET_WORTH_20_XRND",
    "CVC_HH_NET_WORTH_25_XRND",
    "CVC_ASSETS_FINANCIAL_25_XRND",
    "CVC_ASSETS_DEBTS_20_XRND",
    "CVC_HH_NET_WORTH_30_XRND",
    "CVC_HOUSE_VALUE_30_XRND",
    "CVC_HOUSE_TYPE_30_XRND",
    "CVC_ASSETS_FINANCIAL_30_XRND",
    "CVC_ASSETS_DEBTS_30_XRND")

### Set all negative values to NA.  
### THIS IS DONE ONLY FOR ILLUSTRATIVE PURPOSES
### DO NOT TAKE THIS APPROACH WITHOUT CAREFUL JUSTIFICATION
#nlsy[nlsy < 0]  <- NA
# use mutate if/else


#Create a data dictionary that helps with sorting and finding information on data columns
# encoded.val <- code.dict[legible.names == "Legiblename",2]
legible.names <- names(nlsy)
code.dict <- data.frame(legible.names,encoded.names)
```

#### Data Clean & Recoding
```{r}
#Rename and Recode Select Covariates
nlsy <- as_tibble(nlsy) %>%
  rename(cocaine_use = 'YSAQ-372CC_2011',
         smokes = 'YSAQ-360C_2011',
         drinks = 'YSAQ-364D_2011',
         HHIC_1997 = 'CV_HH_NET_WORTH_P_1997',
         first.incarceration = 'INCARC_AGE_FIRST_XRND',
         residence = 'CV_URBAN-RURAL_AGE_12_1997') %>%
  mutate(marital_status = recode_factor(CV_MARSTAT_COLLAPSED_2017, 
                                        `0`="NEVER-MARRIED", 
                                        `1` = "MARRIED", 
                                        `2` = "SEPARATED", 
                                        `3` = "DIVORCED", 
                                        `4` = "WIDOWED", 
                                        `-5` = "UNKNOWN", 
                                        `-3` = "UNKNOWN")) %>%
  mutate(sex = recode_factor(sex, `1`="MALE", #set Male as Baseline
                             `2`="FEMALE")) %>%
  mutate(race = recode_factor(race, 
                              `4` = "NON-BLACK/NON-HISPANIC",#set non-Black/non-Hispanic as Baseline
                              `1` = "BLACK", 
                              `2` = "HISPANIC", 
                              `3` = "MIXED-RACE (NON-HISP.)"
                              )) %>%
  mutate(HHIC_1997 = case_when(HHIC_1997<0 ~ NA_real_, HHIC_1997>0 ~ HHIC_1997)) %>%
  mutate(emp.industry = cut(nlsy$`YEMP_INDCODE-2002.01_2017`, breaks = c(-5,0,169,290,369,490,569,690,769,770,1069,3990,4069,4590,4669,5790,5889,5890,6069,6390,6469,6780,6869,7190,7269,7790,7859,8470,8559,8690,8769,9290,9369,9590,9669,9890,9949,9990), labels = c("UNKNOWN","NA","AGRICULTURE, FORESTRY, FISHING","NA","MINING","NA","UTILITIES","NA","CONSTRUCTION","NA","MANUFACTURING","NA", "WHOLESALE TRADE","NA","RETAIL TRADE","NA","ENTERTAINMENT","NA","TRANSPORTATION AND wHAREHOUSING","NA","INFORMATION AND COMMUNICATION", "NA", "FINANCE, INSURANCE, AND REAL ESTATE","NA","PROFESSIONAL AND RELATED SERVICES", "NA", "EDUCATIONAL, HEALTH, AND SOCIAL SERVICES","NA","ENTERTAINMENT, ACCOMODATIONS, AND FOOD SERVICES", "NA","OTHER SERVICES","NA","PUBLIC ADMINISTRATION","NA","ACTIVE DUTY MILITARY","NA","ACS SPECIAL CODES"),include.lowest = TRUE)) %>% 
  mutate(birth.mom.age = cut(nlsy$CV_BIO_MOM_AGE_YOUTH_1997, breaks = c(-Inf,0,19,29,39,49,59), labels = c("Unknown","Child/Teen","20s","30s","40s","50s+"), ordered_result = TRUE)) %>%
  mutate(first.incarceration = case_when(first.incarceration<0 ~ NA_real_, first.incarceration>0 ~ first.incarceration)) %>%
  mutate(residence = recode_factor(residence,`2` = "UNKNOWN",
                                   `-3` = "UNKNOWN",
                                   `-4` = "UNKNOWN",
                                   `0` = "RURAL",
                                   `1` = "URBAN")) %>%
  mutate_at(c("cocaine_use", "smokes", "drinks"), ~ recode_factor(.x, `0` = "NO", `1` = "YES", .default = "UNKNOWN"))

```

###Understanding the basics
```{r}
table(nlsy$sex)
table(nlsy$race)
table(nlsy$marital_status)
table(nlsy$emp.industry)
table(nlsy$birth.mom.age)
table(nlsy$cocaine_use)
table(nlsy$smokes)
table(nlsy$drinks)
table(nlsy$residence)
summary(nlsy$HHIC_1997)
#table(nlsy$HHIC_1997) <-- I wonder if we should cut this into categories like low income mid income and high income?

```
#### Data Exploration - 12/12

```{r}
#Average net worth of household in 1997 by gender as reported by parent
income.data.HHIC1997 <- nlsy %>%
  group_by(sex) %>%
  summarize("avg.HHIC_1997" = mean(HHIC_1997, na.rm = TRUE),
            'lower' = t.test(HHIC_1997, mu = mean(HHIC_1997, na.rm = TRUE))$conf.int[1],
            'upper' = t.test(HHIC_1997, mu = mean(HHIC_1997,na.rm = TRUE))$conf.int[2])
income.data.HHIC1997


ggplot(data = income.data.HHIC1997, aes(x=sex, y=avg.HHIC_1997, fill=I("steelblue"))) + 
  geom_bar(stat = "identity") +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.1, position = position_dodge(0.9)) +
  xlab("Gender") +
  ylab("AVG Household Net Worth 1997") +
  ggtitle("AVG Household Net Worth 1997 of Men and Women (According to Parent)") +
  guides(fill = FALSE) #No statistically significant difference in average houshold net worth between men and women


#topcoding truncates the data trends
#you see a less of a range between 150K and mx income which is interesting, there is not gradient like with 
#Percentage of high earning men is clearly greater
ggplot(data = nlsy, aes(x=HHIC_1997, y=income, colour = sex, shape = sex))+
  geom_point(alpha = 0.3)

#No significant difference in HHIC_1997 between men and women
#amongst the same demographic, but you do observie a significant right tale:
#the data is not normally distributed, which shows that white individuals
#have HHIC_1997 > than other groups
ggplot(data = nlsy, aes(x=HHIC_1997)) +
  geom_density(alpha = 0.5, aes(fill = sex))

ggplot(data = nlsy, aes(x=HHIC_1997)) +
  geom_density(alpha = 0.5, aes(fill = sex, race))


income.data.fincarcerate <- nlsy %>%
  group_by(sex) %>%
  summarize("avg.firstincarcerate" = mean(first.incarceration, na.rm = TRUE),
            'lower' = t.test(first.incarceration, mu = mean(first.incarceration, na.rm = TRUE))$conf.int[1],
            'upper' = t.test(first.incarceration, mu = mean(first.incarceration,na.rm = TRUE))$conf.int[2])

income.data.fincarcerate

#Output table regarding count of indv. with zero incomes as a funciton of incarceration status & gender

nlsy.incarcerate <- nlsy %>%
  mutate(INCARC_TOTNUM_XRND = case_when(INCARC_TOTNUM_XRND ==0 ~ "NO", first.incarceration >0 ~ "YES"))


#Jaih to work on this and do a proportionality test to help support findings

income.data.fincarcerate.prop <- nlsy.incarcerate %>%
  group_by(sex,INCARC_TOTNUM_XRND) %>%
  summarize("# Zero Income" = sum(income <= 0, na.rm = TRUE),
            "# Above Zero Income" = sum(income > 0, na.rm = TRUE))

income.data.fincarcerate.prop <- income.data.fincarcerate.prop[!is.na(income.data.fincarcerate.prop$INCARC_TOTNUM_XRND) &
                                                                 income.data.fincarcerate.prop$INCARC_TOTNUM_XRND == "YES" ,]

#Data seems conglomerated around specific age ranges
#Not enough women incarcerated
#Does look like income is not as high for those incarcerated.
#A lot of zero incomes for incarceration at any age
ggplot(data = nlsy, aes(x=first.incarceration, y=income, colour = sex, shape = sex))+
  geom_point(alpha = 0.3)


gap.data.residence <- nlsy %>%
  group_by(residence) %>%
 summarize(income.gap = mean(income[sex == "MALE"], na.rm = TRUE) -
              mean(income[sex == "FEMALE"], na.rm = TRUE))

### Residence (Urban, Rural, Unknown)
ggplot(data = gap.data.residence, aes(x=residence, y=income.gap, fill=I("steelblue"))) + geom_bar(stat = "identity") +
  xlab("Location of Residence") +
  ylab("Income Gap($)") +
  ggtitle("Income Gap between Men and Women, by Residence Location") +
  guides(fill = FALSE)
```

###Data Exploration
####Is there a wage gap between Men and Women? 
####Does it persist over factors like race and marital status?
```{r}
#sum(total.income < 0) # total na values

#nlsy[nlsy < 0]  <- NA

###RACE, SEX, MARITAL STATUS
t.test(income ~ sex, data = nlsy) #statistically significant difference between avg incomes for men and women

income.data.gender <- nlsy %>%
  group_by(sex) %>%
 summarize(avg.income = mean(income),
           upper = t.test(income)$conf.int[1],
           lower = t.test(income)$conf.int[2]
           )

ggplot(data = income.data.gender, aes(x=sex, y=avg.income, fill=I("steelblue"))) + geom_bar(stat = "identity") +
  xlab("Gender") +
  ylab("Income") +
  ggtitle("AVG Income of Men and Women") +
  guides(fill = FALSE) +
  geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1)
  #obvious gap between average income between men and women. Appears to be statistically significant based off of error bars

gap.data.gender.race <- nlsy %>% 
  group_by(race) %>%
  summarize(income.gap = mean(income[sex == "MALE"], na.rm = TRUE) 
            - mean(income[sex == "FEMALE"], na.rm = TRUE),
           upper = t.test(income ~ sex)$conf.int[1],
           lower = t.test(income ~ sex)$conf.int[2],
           is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))
  
gap.data.gender.race$is.significant <- recode(gap.data.gender.race$is.significant, `0` = FALSE, `1` = TRUE)


ggplot(data = gap.data.gender.race, aes(x=race, y=income.gap, fill=is.significant)) + geom_bar(stat = "identity") +
  xlab("Race") +
  ylab("Income Gap($)") +
  ggtitle("Income Gap between Men and Women, by Race") +
    theme(axis.text.x=element_text(angle = -15, vjust = 0)) +
    geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1)
#Income gap does persist over race but there is noticeable difference in the gaps
#the wage gap is statistically significant for hispanic men and women and for non-black non-hispanic men and women.

gap.data.marital_stat <- nlsy %>%
  group_by(marital_status) %>%
 summarize(income.gap = mean(income[sex == "MALE"], na.rm = TRUE) 
           - mean(income[sex == "FEMALE"], na.rm = TRUE),
           upper = t.test(income ~ sex)$conf.int[1],
           lower = t.test(income ~ sex)$conf.int[2],
           is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

ggplot(data = gap.data.marital_stat, aes(x=marital_status, y=income.gap, fill=is.significant)) + geom_bar(stat = "identity") +
  xlab("Marital Status") +
  ylab("Income Gap($)") +
  ggtitle("Income Gap between Men and Women, by Marital Status") +
    theme(axis.text.x=element_text(angle = -90, vjust = 0))
  #geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1)
#Huge gap in income between married men and women vs non-married

```
```{r}
### ALCOHOL, TOBACCO, HARD DRUGS(Cocaine)
gap.data.gender.smokes <- nlsy %>% 
  group_by(smokes) %>%
  summarize(income.gap = mean(income[sex == "MALE"], na.rm = TRUE) - mean(income[sex == "FEMALE"], na.rm = TRUE),
           upper = t.test(income ~ sex)$conf.int[1],
           lower = t.test(income ~ sex)$conf.int[2],
           is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

ggplot(data = gap.data.gender.smokes, aes(x=smokes, y=income.gap, fill=is.significant)) + geom_bar(stat = "identity") +
  xlab("Smokes") +
  ylab("Income Gap($)") +
  ggtitle("Income Gap between Men and Women, by Smokes") +
  geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1)
#slight difference in wage gap between men and women who smoke. Not statistically significant based off error bars. Will not include in linear model.

gap.data.gender.cocaine_use <- nlsy %>% 
  group_by(cocaine_use) %>%
  summarize(income.gap = mean(income[sex == "MALE"], na.rm = TRUE) - mean(income[sex == "FEMALE"], na.rm = TRUE),
           upper = t.test(income ~ sex)$conf.int[1],
           lower = t.test(income ~ sex)$conf.int[2],
           is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

ggplot(data = gap.data.gender.cocaine_use, aes(x=cocaine_use, y=income.gap, fill=is.significant)) + geom_bar(stat = "identity") +
  xlab("Cocaine Use") +
  ylab("Income Gap($)") +
  ggtitle("Income Gap between Men and Women, by Cocaine Use") +
    geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1)
#Cocaine use does not seem to affect the wage gap at all. The bars are almost of equal height.

gap.data.gender.drinks <- nlsy %>% 
  group_by(drinks) %>%
  summarize(income.gap = mean(income[sex == "MALE"], na.rm = TRUE) -
              mean(income[sex == "FEMALE"], na.rm = TRUE),
           upper = t.test(income ~ sex)$conf.int[1],
           lower = t.test(income ~ sex)$conf.int[2],
           is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

ggplot(data = gap.data.gender.drinks, aes(x=drinks, y=income.gap, fill=is.significant)) + geom_bar(stat = "identity") +
  xlab("Drinks") +
  ylab("Income Gap($)") +
  ggtitle("Income Gap between Men and Women, by Drinks") +
    geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1)
#Noticeable difference in the wage gap between men and women who drink and don't drink but still not seemingly significant based on error bars.

#ALL of these showed substance use has no affect on the wage gap. The wage gap is significant for every category of substance use whether they partake or not.
```
```
U17180.00    [YEMP_INDCODE-2002.01]                         Survey Year: 2017
  PRIMARY VARIABLE

 
             YEMP, TYPE OF BUS OR INDUSTRY CODE (2002 CENSUS 4-DIGIT) 01 (ROS 
             ITEM)
 
UNIVERSE: R >= 14 has valid employer
These are 2002 Census Industry Codes
 
      43         170 TO 290: AGRICULTURE, FORESTRY AND FISHERIES
      29         370 TO 490: MINING
      32         570 TO 690: UTILITIES
     391         770: CONSTRUCTION
     493        1070 TO 3990: MANUFACTURING
     127        4070 TO 4590: WHOLESALE TRADE
     560        4670 TO 5790: RETAIL TRADE
       0        5890: ARTS, ENTERTAINMENT AND RECREATION SERVICES
     262        6070 TO 6390: TRANSPORTATION AND WAREHOUSING
     107        6470 TO 6780: INFORMATION AND COMMUNICATION
     392        6870 TO 7190: FINANCE, INSURANCE, AND REAL ESTATE
     757        7270 TO 7790: PROFESSIONAL AND RELATED SERVICES
    1355        7860 TO 8470: EDUCATIONAL, HEALTH, AND SOCIAL SERVICES
     529        8560 TO 8690: ENTERTAINMENT, ACCOMODATIONS, AND FOOD SERVICES
     237        8770 TO 9290: OTHER SERVICES
     262        9370 TO 9590: PUBLIC ADMINISTRATION
      13        9670 TO 9890: ACTIVE DUTY MILITARY
     225        9950 TO 9990: ACS SPECIAL CODES
  -------
    5814
 
Refusal(-1)            0
Don't Know(-2)         0
Invalid Skip(-3)      65
TOTAL =========>    5879   VALID SKIP(-4)     855     NON-INTERVIEW(-5)    2250
 
Min:            170        Max:           9990        Mean:              6609.4
 
Hard Minimum: [0]
Hard Maximum: [9999]
```
```{r}
nlsy.no.military <- subset(nlsy, emp.industry!="ACTIVE DUTY MILITARY")
#removed active duty military because there were no women in the survey and could not calculate a wage gap


gap.data.gender.industry <- nlsy.no.military %>% 
  group_by(emp.industry) %>%
  summarize(income.gap = mean(income[sex == "MALE"], na.rm = TRUE) -
              mean(income[sex == "FEMALE"], na.rm = TRUE),
           upper = t.test(income ~ sex)$conf.int[1],
           lower = t.test(income ~ sex)$conf.int[2],
           is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

ggplot(data = gap.data.gender.industry,aes(x=emp.industry, y=income.gap, fill=is.significant)) + 
  geom_bar(stat = "identity") +
  xlab("Industry") +
  ylab("Income Gap ($)") +
  ggtitle("Income Gap between Men and Women, by Industry") +
  theme(axis.text.x=element_text(angle = -90, vjust = 0, size=5)) #+     geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1)
#Persistent statistically significant wage gap between men and women even across industries
```

```{r}

#nlsy <- nlsy[nlsy$income > 0 & nlsy$income < 150000,] # only rows of people that make money within a certain range for income and housing. give justification

#nlsy <- nlsy[nlsy$income == 0, ] # further investigation this population

#ggplot(
#       subset(gap.data.gender.industry, residence %in% c("RURAL", "URBAN")),
#       aes(x=emp.industry, y=income.gap,fill=residence)) + 
#  geom_bar(stat = "identity") +
#  facet_grid(residence~.)+
#  xlab("Industry") +
#  ylab("Income Gap($)") +
#  ggtitle("Income Gap between Men and Women, by Industry & Residence") +
#  guides(fill = FALSE) +
#  theme(axis.text.x=element_text(angle = -40, vjust = 0))
```

#### Collinearity Testing -12/12/20

```{r}
#batch.one.var.names <-c("HHIC_1997", "residence", "race", "marital_status", "")
#ggpairs(nlsy[,batch.one.var.names], axisLabels = "internal")


#batch.two.var.names <-c("cocaine_use", "smokes", "drinks", "first.incarceration", "CV_BIO_MOM_AGE_YOUTH_1997")
#ggpairs(nlsy[,batch.two.var.names], axisLabels = "internal")




```

```
R12002.00    [CV_BIO_MOM_AGE_YOUTH]                         Survey Year: 1997
  PRIMARY VARIABLE

 
             AGE OF BIO MOTHER WHEN R BORN
 
Age of biological mother when respondent born.
/* EXTREME RESPONSES REFLECT UNEDITED INTERVIEW DATA THAT WERE REPORTED DURING 
THE SURVEY; RESEARCHERS MAY WANT TO EVALUATE THESE DATA BEFORE DRAWING 
CONCLUSIONS. */
 
       0           0
       0           1 TO 4
       0           5 TO 8
      34           9 TO 14
    1089          15 TO 19
    2725          20 TO 24
    2633          25 TO 29
    1387          30 TO 34
     435          35 TO 39
      57          40 TO 44
       8          45 TO 49
       8          50 TO 99999999: 50+
  -------
    8376
 
Refusal(-1)            0
Don't Know(-2)         0
Invalid Skip(-3)     608
TOTAL =========>    8984   VALID SKIP(-4)       0     NON-INTERVIEW(-5)       0
 
Min:             10        Max:            101        Mean:                25.5
 
Hard Minimum: [0]
Hard Maximum: [118]
```
```{r}
nlsy.valid_mom_age <- subset(nlsy, CV_BIO_MOM_AGE_YOUTH_1997 > 0)

gap.data.AGE_MOM_YOUTH <- nlsy.valid_mom_age %>%
  group_by(birth.mom.age) %>%
 summarize(
   income.gap = mean(income[sex == "MALE"], na.rm = TRUE) -
              mean(income[sex == "FEMALE"], na.rm = TRUE)
   )

ggplot(data = gap.data.AGE_MOM_YOUTH, aes(x=birth.mom.age, y=income.gap, fill=I("steelblue"))) + geom_bar(stat = "identity") +
  xlab("Age of Mother at Birth of Child") +
  ylab("Income Gap($)") +
  ggtitle("Income Gap between Men and Women, by Age of Mother at Birth") +
  guides(fill = FALSE)

ggplot(nlsy.valid_mom_age, aes(x = CV_BIO_MOM_AGE_YOUTH_1997,)) + xlab("Mother's Age at Birth of Child") + geom_histogram(aes(fill = race))

plot.interact <- qplot(x = CV_BIO_MOM_AGE_YOUTH_1997, y = income, color = sex, data = nlsy.valid_mom_age) + stat_smooth(method = "lm", se = FALSE, fullrange = TRUE)
plot.interact

#in general we can see that mother's age when child was born is positively correlated with income for both men and women.


```
```{r}
### COLINEARITY TESTS
library(GGally)
#income.vars <- c("sex","race","marital_status","emp.industry","residence")
#income.vars.noindustry <- c("sex","race","marital_status","residence")
#ggpairs(nlsy[,c("sex","race","marital_status")], cardinality_threshold = 30)

#USE SOMETHING LIKE THIS... ONLY test for colinearity between variables that seem like they would be colinear

# Function taken from ?pairs Example section.  
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = pmax(1, cex.cor * r))
}

# Use panel.cor to display correlations in lower panel.
pairs(crime[,economic.var.names], lower.panel = panel.cor)


```

```{r}
###LET'S RUN SOME REGRESSIONS
lm.sex <- lm(income ~ sex, data = nlsy)
kable(coef(summary(lm.sex)), digits = c(0, 0, 2, 4))

lm.race.sex <- lm(income ~ sex + sex*race, data = nlsy)
kable(coef(summary(lm.race.sex)), digits = c(0, 0, 2, 4))

lm.race.sex.residence <-lm(income ~ sex + sex*race*residence, data = nlsy)
kable(coef(summary(lm.race.sex.residence)), digits = c(0, 0, 2, 4))

lm.race.sex.mar_stat <- lm(income ~ sex + sex*race*marital_status, data = nlsy) ###The most significant out of the bunch
kable(coef(summary(lm.race.sex.mar_stat)), digits = c(0, 0, 2, 4))

lm.race.sex.industry <- lm(income ~ sex + sex*race*emp.industry, data = nlsy)
kable(coef(summary(lm.race.sex.industry)), digits = c(0, 0, 2, 4))

lm.race.sex.mar_stat.industry <- lm(income ~ sex + sex*race*marital_status*emp.industry, data = nlsy)

kable(coef(summary(lm.race.sex.mar_stat.industry)), digits = c(0, 0, 2, 4))

anova(lm.sex, lm.race.sex, lm.race.sex.residence, lm.race.sex.mar_stat, lm.race.sex.industry, lm.race.sex.mar_stat.industry)

```


#### A note on missing values

Here's an example of what the variable description files look like

```
T76400.00    [YSAQ-372CC]                                   Survey Year: 2011
  PRIMARY VARIABLE

 
             HAS R USED COCAINE/HARD DRUGS SINCE DLI?
 
Excluding marijuana and alcohol, since the date of last interview, have you used
any drugs like cocaine, crack, heroin, or crystal meth, or any other substance 
not prescribed by a doctor, in order to get high or to achieve an altered state?
 
UNIVERSE: All except prisoners in an insecure environment
 
     215       1 YES   (Go To T76401.00)
    7023       0 NO
  -------
    7238
 
Refusal(-1)           74
Don't Know(-2)        26
TOTAL =========>    7338   VALID SKIP(-4)      85     NON-INTERVIEW(-5)    1561
 
Min:              0        Max:              1        Mean:                 .03
 
Lead In: T76397.00[Default] T76399.00[Default]  T76398.00[0:0]
Default Next Question: T76403.00
```

This description says that the numbers -1, -2, -4 and -5 all have a special meaning for this variable.  They denote different types of missingness.  You can recode all of these to `NA`, but you should also think about whether the different missigness indicators are in some way informative.  (i.e., if someone refuses to answer questions related to drug use, might this inform us about their income?) 

#### Getting to know our two main variables.

In the previous chunk of code we have appropriately renamed the variables corresponding to `sex`, `race` and `income` (as reported on the 2017 survey).  Let's have a quick look at what we're working with.

```{r}
table(nlsy$sex)

table(nlsy$race)
```

The data codebook tells us that the coding for sex is `Male = 1`, `Female = 2`.  For the race/ethnicity variable, the coding is:

```
1 Black
2 Hispanic
3 Mixed Race (Non-Hispanic)
4 Non-Black / Non-Hispanic
```

You'll want to do some data manipulations to change away from the numeric codings to more interpretable labels. 

```{r}
summary(nlsy$income)

# Histogram
qplot(nlsy$income)
```

The income distributing is right-skewed like one might expect.  However, as indicated in the question description, the income variable is *topcoded* at the 2% level.  More precisely,

```{r}
n.topcoded <- with(nlsy, sum(income == max(income, na.rm = TRUE), na.rm = TRUE))
n.topcoded
```

`r n.topcoded` of the incomes are topcoded to the maximum value of `r max(nlsy$income, na.rm = TRUE)`, which is the average value of the top `r n.topcoded` earners.    You will want to think about how  to deal with this in your analysis.